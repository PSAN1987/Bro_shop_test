<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>WEBフォーム注文</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0; padding: 0;
      font-family: sans-serif;
      background-color: #ffeef2; /* 淡いピンク */
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 1em;
      background-color: #fff;
      border-radius: 8px;
    }
    h1 {
      text-align: center;
      color: #d15b8f;
    }
    .form-group {
      margin-bottom: 1em;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.3em;
      font-weight: bold;
    }
    .form-group select,
    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group input[type="date"],
    .form-group input[type="email"] {
      width: 100%;
      padding: 0.5em;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .size-inputs {
      display: block;
      flex-wrap: wrap;
      gap: 1em;
    }
    .size-inputs .sub-group {
      flex: 1;
      min-width: 100px;
    }
    .sub-group { margin-bottom: 0.5em; }
    .hidden { display: none; }
    .submit-btn {
      text-align: center;
      margin-top: 2em;
    }
    .submit-btn button {
      background-color: #d15b8f;
      color: #fff;
      border: none;
      padding: 1em 2em;
      border-radius: 4px;
      font-size: 1em;
      cursor: pointer;
    }
    .submit-btn button:hover {
      opacity: 0.8;
    }
    fieldset {
      border: 1px solid #ccc;
      padding: 1em;
      margin-bottom: 1em;
    }
    legend { font-weight: bold; }
    .inline-flex {
      display: flex;
      align-items: center;
      gap: 0.5em;
    }
    .mt1 { margin-top: 1em; }
    .mb1 { margin-bottom: 1em; }
  /* 既存 <style> 内の末尾などに追記 */
    .back-btn{
    background:#777;
    color:#fff;
    border:none;
    padding:.4em .9em;
    border-radius:4px;
    font-size:.9em;
    cursor:pointer;
    margin-top:.5em;
  }
  .back-btn:hover{ opacity:.8; }
  /* 既存 <style> の末尾などに追加 ------------------------------ */
    .del-btn{
    background:#e74c3c;   /* 赤 */
    color:#fff;
    border:none;
    padding:.4em .9em;
    border-radius:4px;
    font-size:.9em;
    cursor:pointer;
    margin-left:.5em;
  }
  .del-btn:hover{ opacity:.85; }
  .add-color-btn{
  margin-top:.4em;
  background:#d15b8f;
  color:#fff;
  border:none;
  padding:.3em .9em;
  border-radius:4px;
  font-size:.85em;
  cursor:pointer;
  }
  .add-color-btn:disabled{opacity:.4;cursor:default;}
  .color-box select{margin-bottom:.4em;width:100%;}
  .full-color-select{display:block;width:100%;margin-top:.4em;}
  .catalog-btn{
  display:inline-block;
  padding:.55em 1.6em;
  background:#4a8fd8;
  color:#fff;
  font-size:.9em;
  border-radius:4px;
  text-decoration:none;
  }
  .catalog-btn:hover{opacity:.8;}
  .hidden-opt { display:none; }   /* ← ★これを追加するだけ */
  </style>
</head>
<body>
<div class="container">
  <h1>WEBフォーム注文</h1>
  <p style="text-align:center; margin:-0.5em 0 1.2em;">
    <a href="https://saas.actibookone.com/content/detail?param=eyJjb250ZW50TnVtIjo1Njk0OTd9&detailFlg=1&pNo=1"
       target="_blank"
       class="catalog-btn">カタログ参照</a>
  </p>
  <!-- 送信先: /submit_web_order_form  /  POST で送る -->
  <form id="orderForm" action="/submit_web_order_form" method="post">
    <input type="hidden" name="quote_no" value="{{ quote_no }}">
    <input type="hidden" name="lineUserId" id="lineUserId">
    <!-- CSRF 用ワンタイムトークン -->
    <input type="hidden" name="form_token" value="{{ token }}">
    <input type="hidden" name="orderNo" value="{{ initial_data.orderNo or '' }}">  <!-- ✅ この行を追加 -->

    <!-- ▼ 製品選択（商品名 → 品番 → 商品カラー → カラーNo）▼ -->
    <div class="form-group">
      <label for="productNameSelect">商品名 <span style="color:red;">(必須)</span></label>
      <!-- ▼ 追加 ▼ -->
      <a href="https://saas.actibookone.com/content/detail?param=eyJjb250ZW50TnVtIjo1Njk0OTd9&detailFlg=1&pNo=4"
        target="_blank"
        style="margin-left:.4em; font-size:.8em; color:#4a8fd8;">カタログ</a>
      <!-- ▲ 追加 ▲ -->
      <select id="productNameSelect" name="productName" required>
        <option value="">選択してください</option>
      </select>
    </div>

    <div class="form-group">
      <label for="productNoSelect">品番 <span style="color:red;">(必須)</span></label>
      <select id="productNoSelect" name="productNo" required>
        <option value="">選択してください</option>
      </select>
    </div>

    <!-- 商品カラーを先に選ぶ -->
    <div class="form-group">
      <label for="colorNameSelect">商品カラー <span style="color:red;">(必須)</span></label>
      <select id="colorNameSelect" name="colorName" required>
        <option value="">選択してください</option>
      </select>
    </div>

    <!-- その後にカラーNoを選択 -->
    <div class="form-group">
      <label for="colorNoSelect">カラーNo <span style="color:red;">(必須)</span></label>
      <select id="colorNoSelect" name="colorNo" required>
        <option value="">選択してください</option>
      </select>
    </div>

    <!-- ▼ サイズ毎の枚数入力 ▼ -->
    <div class="form-group">
      <label>サイズ毎の枚数 <span style="color:red;">(必須)</span></label>
      <div class="size-inputs">
        <div class="sub-group">
          <label for="size150">150</label>
          <input type="number" id="size150" name="size150" value="0" min="0" required oninput="calculateTotal()">
        </div>
        <div class="sub-group">
          <label for="sizeSS">SS(160)</label>
          <input type="number" id="sizeSS" name="sizeSS" value="0" min="0" required oninput="calculateTotal()">
        </div>
        <div class="sub-group">
          <label for="sizeS">S</label>
          <input type="number" id="sizeS" name="sizeS" value="0" min="0" required oninput="calculateTotal()">
        </div>
        <div class="sub-group">
          <label for="sizeM">M</label>
          <input type="number" id="sizeM" name="sizeM" value="0" min="0" required oninput="calculateTotal()">
        </div>
        <div class="sub-group">
          <label for="sizeL">L(F)</label>
          <input type="number" id="sizeL" name="sizeL" value="0" min="0" required oninput="calculateTotal()">
        </div>
        <div class="sub-group">
          <label for="sizeXL">LL(XL)</label>
          <input type="number" id="sizeXL" name="sizeXL" value="0" min="0" required oninput="calculateTotal()">
        </div>
        <div class="sub-group">
          <label for="sizeXXL">3L(XXL)</label>
          <input type="number" id="sizeXXL" name="sizeXXL" value="0" min="0" required oninput="calculateTotal()">
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="totalQuantity">合計枚数</label>
      <input type="number" id="totalQuantity" name="totalQuantity" value="0" readonly>
    </div>

    <!-- ▼ プリント位置のイメージ画像 ▼ -->
    <div class="form-group">
      <label>プリント位置イメージ</label>
      <img src="https://catalog-bot-zf1t.onrender.com/PRINT_LOCATION.png" alt="プリント位置イメージ" style="max-width:90%;">
    </div>

    <!-- ▼ 1ヵ所目のプリント設定（必須）▼ -->
    <fieldset id="printLocation1">
      <legend>1ヵ所目のプリント設定 (必須)</legend>

      <!-- プリント位置No -->
      <div class="sub-group">
        <label for="printPositionNo1">プリント位置No.</label>
        <select id="printPositionNo1" name="printPositionNo1" required>
          <option value="">選択</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
        </select>
      </div>

              <!-- デザイン番号 -->
              <div class="sub-group" id="designGroup1">
                <label for="designCode1">デザイン (例: D-001)
                  <!-- ▼ 追加 ▼ -->
                  <a href="https://saas.actibookone.com/content/detail?param=eyJjb250ZW50TnVtIjo1Njk0OTd9&detailFlg=1&pNo=18"
                    target="_blank"
                    style="margin-left:.4em; font-size:.8em; color:#4a8fd8;">カタログ</a>
                  <!-- ▲ 追加 ▲ -->
                </label>
                <div style="display:flex; gap:0.3em;">
                  <span>D-</span>
                  <input type="text" id="designCode1" name="designCode1" maxlength="3" style="width:4em;" placeholder="3桁">
                </div>
      </div>
      <!-- ネーム＆番号プリントカラーオプション (プリントカラーでネーム系選択時に表示) -->
      <div id="nameNumberPrintColorBox1" class="sub-group hidden" style="border:1px solid #ccc; padding:0.5em;">
        <strong>ネーム・番号プリントカラーオプション</strong>
        <!-- ← 戻るボタンをここに -->
        <button type="button"
                class="back-btn"
                onclick="backToNormalPrint(1)">
        ← 通常のプリント設定に戻る
        </button>        
        <div class="inline-flex mt1 mb1">
          <label><input type="radio" name="nameNumberPrintType1" value="single" checked onclick="toggleEdgeColor(1)"> 単色</label>
          <label><input type="radio" name="nameNumberPrintType1" value="edge" onclick="toggleEdgeColor(1)"> フチ付き</label>
        </div>
        <!-- 単色 -->
        <div id="singleColorSelectArea1" class="sub-group">
          <label>単色カラー</label>
          <select id="singleColor1" name="singleColor1"></select>
        </div>
        <!-- フチ付き -->
        <div id="edgeColorSelectArea1" class="sub-group hidden">
          <label>フチ付きタイプ</label>
          <select id="edgeType1" name="edgeType1" onchange="changeEdgeType(1)">
            <option value="">選択してください</option>
            <option value="FT-1">FT-1 (文字色ブラック、フチ色1ブラック)</option>
            <option value="FT-2">FT-2 (文字色ホワイト、フチ色1ブラック)</option>
            <option value="FT-3">FT-3 (文字色レッド、フチ色1ブラック)</option>
            <option value="FT-4">FT-4 (文字色パープル、フチ色1イエロー)</option>
            <option value="FT-5">FT-5 (文字色ブラック、フチ色1ホワイト、フチ色2ブラック)</option>
            <option value="FT-6">FT-6 (文字色レッド、フチ色1ホワイト、フチ色2ブラック)</option>
            <option value="FT-7">FT-7 (文字色ブルー、フチ色1ホワイト、フチ色2ブルー)</option>
            <option value="FT-8">FT-8 (文字色ブルー、フチ色1ホワイト、フチ色2レッド)</option>
            <option value="custom">カスタム</option>
          </select>
          <div id="edgeColorCustomArea1" class="hidden" style="margin-top:0.5em;">
            <label>文字色</label>
            <select id="edgeCustomTextColor1" name="edgeCustomTextColor1"></select>
            <label>フチ色1</label>
            <select id="edgeCustomEdgeColor1" name="edgeCustomEdgeColor1"></select>
            <label>フチ色2 (任意)</label>
            <select id="edgeCustomEdgeColor2_1" name="edgeCustomEdgeColor2_1"></select>
          </div>
        </div>
        <!-- フォント -->
        <div class="sub-group mt1">
          <label>フォント選択</label>
          <div class="inline-flex mb1">
            <label><input type="radio" name="fontType1" value="E" checked> 英数字対応 (E-)</label>
            <label><input type="radio" name="fontType1" value="J"> 日本語対応 (J-)</label>
          </div>
          <div class="inline-flex">
            <span id="fontPrefix1">E-</span>
            <input type="text" id="fontNumber1" name="fontNumber1" maxlength="2" style="width:3em;" placeholder="00">
          </div>
        </div>
      </div><!-- /nameNumberPrintColorBox1 -->

      <!-- ▼▼▼ ここから通常プリントカラー・デザイン等をまとめる ▼▼▼ -->
      <div id="normalPrintGroup1">
        <!-- 通常のプリントカラー・オプション (1色目, 2色目, 3色目, フルカラー) -->
        <div class="sub-group">
            <label>プリントカラー・オプション
            <!-- ▼ 追加 ▼ -->
            <a href="https://saas.actibookone.com/content/detail?param=eyJjb250ZW50TnVtIjo1Njk0OTd9&detailFlg=1&pNo=20"
              target="_blank"
              style="margin-left:.4em; font-size:.8em; color:#4a8fd8;">カタログ</a>
            <!-- ▲ 追加 ▲ -->
            </label>
            <!-- 色セレクトをまとめて置くコンテナ -->
            <div id="printColorBox1" class="color-box"></div>
            <!-- 追加ボタン -->
            <button type="button"
                    class="add-color-btn"
                    onclick="addColorSelect(1)">
              ＋色を追加
            </button>
          <!-- フルカラー -->
          <select name="fullColorSize1" class="full-color-select">
            <option value="">フルカラーの場合はこちらを選択</option>
            <option value="S">フルカラー(小)</option>
            <option value="M">フルカラー(中)</option>
            <option value="L">フルカラー(大)</option>
          </select>
        </div>

        <!-- デザインサイズ -->
        <div class="sub-group">
          <label>デザインサイズ</label>
          <select name="designSize1" id="designSize1" onchange="toggleCustomSize(1)">
            <option value="max">プリント位置最大</option>
            <option value="custom">任意のサイズ</option>
          </select>
          <div id="customSizeInput1" class="hidden">
            <label>X(cm)</label>
            <input type="number" name="designSizeX1" min="0" step="0.1" style="width:5em;">
            <label>Y(cm)</label>
            <input type="number" name="designSizeY1" min="0" step="0.1" style="width:5em;">
          </div>
        </div>
      </div>
      <!-- ▲▲▲ normalPrintGroup1 終了 ▲▲▲ -->
    </fieldset>

    <!-- ▼ 追加プリント箇所を動的に生成する領域 & 追加ボタン ▼ -->
    <div id="additionalPrintLocations"></div>

    <div style="margin-bottom:2em;">
      <button type="button"
              onclick="addPrintLocation()"
              style="
                background-color: #d15b8f;
                color: #fff;
                border: none;
                padding: 1em 2em;
                border-radius: 4px;
                font-size: 1em;
                cursor: pointer;
              ">
        + プリント箇所を追加
      </button>
    </div>

    <!-- ▼ 希望お届け日・使用日・申込日 ▼ -->
    <div class="form-group">
      <label for="deliveryDate">希望お届け日 <span style="color:red;">(必須)</span></label>
      <input type="date" id="deliveryDate" name="deliveryDate" required />
    </div>
    <div class="form-group">
      <label for="useDate">使用日 <span style="color:red;">(必須)</span></label>
      <input type="date" id="useDate" name="useDate" required />
    </div>
    <div class="form-group hidden-opt">
        <label for="applicationDate">申込日 (任意)</label>
         <input type="date" id="applicationDate" name="applicationDate">
       </div>

    <!-- ▼ 割引特典 ▼ -->
    <div class="form-group">
      <label for="discountOption">利用する割引特典 <span style="color:red;">(必須)</span></label>
      <select id="discountOption" name="discountOption" required>
        <option value="">選択してください</option>
        <option value="早割">早割</option>
        <option value="いっしょ割">いっしょ割</option>
        <option value="リピータ割">リピータ割</option>
      </select>
    </div>

    <!-- ▼ 学校名/LINEの名前/クラス・団体名 ▼ -->
    <div class="form-group">
      <label for="schoolName">学校名 <span style="color:red;">(必須)</span></label>
      <input type="text" id="schoolName" name="schoolName" required />
    </div>
    <div class="form-group hidden-opt">
        <label for="lineName">LINEの名前 (任意)</label>
        <input type="text" id="lineName" name="lineName">
    </div>
    <div class="form-group hidden-opt">
       <label for="classGroupName">クラス・団体名 (任意)</label>
       <input type="text" id="classGroupName" name="classGroupName">
    </div>

    <!-- ▼ 郵便番号 (必須) & 学校(お届け)住所 ▼ -->
    <div class="form-group">
      <label for="zipCode">お届け先の郵便番号 <span style="color:red;">(必須)</span></label>
      <input type="text" id="zipCode" name="zipCode" placeholder="例: 123-4567" required onblur="autoFillAddress()" />
    </div>
    <div class="form-group">
      <label for="address1">住所1 (都道府県・市区町村等)</label>
      <input type="text" id="address1" name="address1" />
    </div>
    <div class="form-group">
      <label for="address2">住所2 (番地以下) <span style="color:red;">(必須)</span></label>
      <input type="text" id="address2" name="address2" required />
    </div>
    <div class="form-group">
      <label for="addresseeName">
        お届け先宛名 <span style="color:red;">(必須)</span><br>
        <small>※学校お届けの場合はご担任名を入力ください</small>
      </label>
      <input type="text" id="addresseeName" name="addresseeName" required />
    </div>
    <div class="form-group hidden-opt">
        <label for="schoolTel">学校TEL (任意)</label>
        <input type="text" id="schoolTel" name="schoolTel">
    </div>

    <!-- ▼ 代表者情報 ▼ -->
    <div class="form-group">
      <label for="representativeName">代表者 <span style="color:red;">(必須)</span></label>
      <input type="text" id="representativeName" name="representativeName" required />
    </div>
    <div class="form-group">
      <label for="representativeTel">代表者TEL <span style="color:red;">(必須)</span></label>
      <input type="text" id="representativeTel" name="representativeTel" required />
    </div>
    <div class="form-group hidden-opt">
       <label for="representativeEmail">代表者メール (任意)</label>
       <input type="email" id="representativeEmail" name="representativeEmail">
    </div>

    <!-- ▼ デザイン確認方法 ▼ -->
    <div class="form-group">
      <label for="designCheckMethod">デザイン確認方法 <span style="color:red;">(必須)</span></label>
      <select id="designCheckMethod" name="designCheckMethod" required>
        <option value="">選択してください</option>
        <option value="LINE代表者">LINE代表者</option>
        <option value="LINEご担任(保護者)">LINEご担任(保護者)</option>
        <option value="メール代表者">メール代表者</option>
        <option value="メールご担任(保護者)">メールご担任(保護者)</option>
      </select>
    </div>

    <!-- ▼ お支払い方法 ▼ -->
    <div class="form-group">
      <label for="paymentMethod">お支払い方法 <span style="color:red;">(必須)</span></label>
      <select id="paymentMethod" name="paymentMethod" required>
        <option value="">選択してください</option>
        <option value="代金引換">代金引換(ヤマト運輸/現金のみ)</option>
        <option value="コンビニ・郵便振替">コンビニ・郵便振替(後払い)</option>
        <option value="銀行振込(後払い)">銀行振込(後払い)</option>
        <option value="銀行振込(先払い)">銀行振込(先払い)</option>
      </select>
    </div>

<div class="submit-btn">
  <!-- 管理者用：必須チェックなし -->
  <button type="submit" id="draftSubmit" name="submit_mode" value="draft" style="background-color:#777;">下書き保存</button>
  
  <!-- ユーザー用：通常の必須チェックあり -->
  <button type="submit" name="submit_mode" value="final">確定</button>
</div>
  </form>
</div>

<script>
/* ---------- 初期データ (Flask Jinja2でサーバーから注入) ---------- */
const initialData = {
  productName: "{{ initial_data.productName or '' }}",
  productNo: "{{ initial_data.productNo or '' }}",
  colorName: "{{ initial_data.colorName or '' }}",
  colorNo: "{{ initial_data.colorNo or '' }}",
  size150: "{{ initial_data.size150 or 0 }}",
  sizeSS: "{{ initial_data.sizeSS or 0 }}",
  sizeS: "{{ initial_data.sizeS or 0 }}",
  sizeM: "{{ initial_data.sizeM or 0 }}",
  sizeL: "{{ initial_data.sizeL or 0 }}",
  sizeXL: "{{ initial_data.sizeXL or 0 }}",
  sizeXXL: "{{ initial_data.sizeXXL or 0 }}",
  totalQuantity: "{{ initial_data.totalQuantity or 0 }}",
  deliveryDate: "{{ initial_data.deliveryDate or '' }}",
  useDate: "{{ initial_data.useDate or '' }}",
  applicationDate: "{{ initial_data.applicationDate or '' }}",
  discountOption: "{{ initial_data.discountOption or '' }}",
  schoolName: "{{ initial_data.schoolName or '' }}",
  lineName: "{{ initial_data.lineName or '' }}",
  classGroupName: "{{ initial_data.classGroupName or '' }}",
  zipCode: "{{ initial_data.zipCode or '' }}",
  address1: "{{ initial_data.address1 or '' }}",
  address2: "{{ initial_data.address2 or '' }}",
  addresseeName: "{{ initial_data.addresseeName or '' }}",
  schoolTel: "{{ initial_data.schoolTel or '' }}",
  representativeName: "{{ initial_data.representativeName or '' }}",
  representativeTel: "{{ initial_data.representativeTel or '' }}",
  representativeEmail: "{{ initial_data.representativeEmail or '' }}",
  designCheckMethod: "{{ initial_data.designCheckMethod or '' }}",
  paymentMethod: "{{ initial_data.paymentMethod or '' }}",
};

/* ----------- 製品テーブル（省略なし／必ず全商品） ---------- */
const productTable = [
  // 5927-01 ゲームシャツ
  { productNo: "5927-01", productName: "ゲームシャツ", colorNo: "9816", colorName: "ホワイト/ホワイト/ブラック" },
  { productNo: "5927-01", productName: "ゲームシャツ", colorNo: "9887", colorName: "レッド/ホワイト/ブラック" },
  { productNo: "5927-01", productName: "ゲームシャツ", colorNo: "9889", colorName: "アイビーグリーン/ホワイト/ブラック" },
  { productNo: "5927-01", productName: "ゲームシャツ", colorNo: "9888", colorName: "コバルトブルー/ホワイト/ブラック" },
  { productNo: "5927-01", productName: "ゲームシャツ", colorNo: "9856", colorName: "ブラック/ホワイト/ブラック" },
  // 5982-01 ドライベースボールシャツ
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "1002", colorName: "ホワイト/ブラック" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "1095", colorName: "ホワイト/マリンブルー" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "2001", colorName: "ブラック/ホワイト" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "2002", colorName: "ブラック/ブラック" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "6901", colorName: "ラベンダー/ホワイト" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "6001", colorName: "ターコイズブルー/ホワイト" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "4801", colorName: "マリンブルー/ホワイト" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "4001", colorName: "ネイビー/ホワイト" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "2602", colorName: "カナリアイエロー/ブラック" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "6402", colorName: "オレンジ/ブラック" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "6601", colorName: "トロピカルピンク/ホワイト" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "5602", colorName: "レッド/ブラック" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "5801", colorName: "バーガンディ/ホワイト" },
  { productNo: "5982-01", productName: "ドライベースボールシャツ", colorNo: "5001", colorName: "アイビーグリーン/ホワイト" },
  // 300-ACT ドライTシャツ
  { productNo: "300-ACT", productName: "ドライTシャツ", colorNo: "001", colorName: "ホワイト" },
  { productNo: "300-ACT", productName: "ドライTシャツ", colorNo: "153", colorName: "シルバーグレー" },
  { productNo: "300-ACT", productName: "ドライTシャツ", colorNo: "002", colorName: "グレー" },
  { productNo: "300-ACT", productName: "ドライTシャツ", colorNo: "187", colorName: "ダークグレー" },
  { productNo: "300-ACT", productName: "ドライTシャツ", colorNo: "005", colorName: "ブラック" },
  { productNo: "300-ACT", productName: "ドライTシャツ", colorNo: "133", colorName: "ライトブルー" },
  { productNo: "300-ACT", productName: "ドライTシャツ", colorNo: "033", colorName: "サックス" },
  // ...（略。既存すべて。300-ACT, 302-ADP も全パターン列挙）...
  { productNo: "302-ADP", productName: "ドライポロシャツ", colorNo: "001", colorName: "ホワイト" },
  { productNo: "302-ADP", productName: "ドライポロシャツ", colorNo: "002", colorName: "グレー" },
  { productNo: "302-ADP", productName: "ドライポロシャツ", colorNo: "187", colorName: "ダークグレー" },
  { productNo: "302-ADP", productName: "ドライポロシャツ", colorNo: "005", colorName: "ブラック" },
  { productNo: "302-ADP", productName: "ドライポロシャツ", colorNo: "133", colorName: "ライトブルー" },
  // ...（必要なだけ商品マスタを続ける）...
];

/* ------- セレクトボックス動的制御・初期値復元 -------- */
const productNameSelect = document.getElementById("productNameSelect");
const productNoSelect   = document.getElementById("productNoSelect");
const colorNameSelect   = document.getElementById("colorNameSelect");
const colorNoSelect     = document.getElementById("colorNoSelect");

function setProductNameOptions() {
  const names = Array.from(new Set(productTable.map(i=>i.productName)));
  productNameSelect.innerHTML = '<option value="">選択してください</option>';
  names.forEach(n => {
    const opt = document.createElement("option");
    opt.value = n;
    opt.textContent = n;
    productNameSelect.appendChild(opt);
  });
}
function setProductNoOptions() {
  const selectedName = productNameSelect.value;
  productNoSelect.innerHTML   = '<option value="">選択してください</option>';
  colorNameSelect.innerHTML   = '<option value="">選択してください</option>';
  colorNoSelect.innerHTML     = '<option value="">選択してください</option>';
  if (!selectedName) return;
  const nos = Array.from(
    new Set(productTable.filter(i=> i.productName === selectedName).map(i=> i.productNo))
  );
  nos.forEach(n=>{
    const opt = document.createElement("option");
    opt.value = n;
    opt.textContent = n;
    productNoSelect.appendChild(opt);
  });
}
function setColorNameOptions() {
  const selectedName = productNameSelect.value;
  const selectedNo   = productNoSelect.value;
  colorNameSelect.innerHTML = '<option value="">選択してください</option>';
  colorNoSelect.innerHTML   = '<option value="">選択してください</option>';
  if(!selectedName || !selectedNo) return;
  const cNames = Array.from(
    new Set(
      productTable.filter(i=> i.productName===selectedName && i.productNo===selectedNo)
                 .map(i=> i.colorName)
    )
  );
  cNames.forEach(cn => {
    const opt = document.createElement("option");
    opt.value = cn;
    opt.textContent = cn;
    colorNameSelect.appendChild(opt);
  });
}
function setColorNoOptions() {
  const selectedName    = productNameSelect.value;
  const selectedNo      = productNoSelect.value;
  const selectedCname   = colorNameSelect.value;
  colorNoSelect.innerHTML = '<option value="">選択してください</option>';
  if(!selectedName || !selectedNo || !selectedCname) return;
  const matches = productTable.filter(i=>
    i.productName===selectedName && i.productNo===selectedNo && i.colorName===selectedCname
  );
  matches.forEach(m => {
    const opt = document.createElement("option");
    opt.value = m.colorNo;
    opt.textContent = m.colorNo;
    colorNoSelect.appendChild(opt);
  });
  if(matches.length === 1) colorNoSelect.selectedIndex = 1;
}

/* ---------- 全項目を初期値で復元（ページ読込時に呼ぶ） ---------- */
function restoreAllFields() {
  setProductNameOptions();
  productNameSelect.value = initialData.productName;
  setProductNoOptions();
  productNoSelect.value = initialData.productNo;
  setColorNameOptions();
  colorNameSelect.value = initialData.colorName;
  setColorNoOptions();
  colorNoSelect.value = initialData.colorNo;

  // サイズ
  document.getElementById("size150").value = initialData.size150;
  document.getElementById("sizeSS").value = initialData.sizeSS;
  document.getElementById("sizeS").value = initialData.sizeS;
  document.getElementById("sizeM").value = initialData.sizeM;
  document.getElementById("sizeL").value = initialData.sizeL;
  document.getElementById("sizeXL").value = initialData.sizeXL;
  document.getElementById("sizeXXL").value = initialData.sizeXXL;
  document.getElementById("totalQuantity").value = initialData.totalQuantity;

  // その他
  document.getElementById("deliveryDate").value = initialData.deliveryDate;
  document.getElementById("useDate").value = initialData.useDate;
  document.getElementById("applicationDate").value = initialData.applicationDate;
  document.getElementById("discountOption").value = initialData.discountOption;
  document.getElementById("schoolName").value = initialData.schoolName;
  document.getElementById("lineName").value = initialData.lineName;
  document.getElementById("classGroupName").value = initialData.classGroupName;
  document.getElementById("zipCode").value = initialData.zipCode;
  document.getElementById("address1").value = initialData.address1;
  document.getElementById("address2").value = initialData.address2;
  document.getElementById("addresseeName").value = initialData.addresseeName;
  document.getElementById("schoolTel").value = initialData.schoolTel;
  document.getElementById("representativeName").value = initialData.representativeName;
  document.getElementById("representativeTel").value = initialData.representativeTel;
  document.getElementById("representativeEmail").value = initialData.representativeEmail;
  document.getElementById("designCheckMethod").value = initialData.designCheckMethod;
  document.getElementById("paymentMethod").value = initialData.paymentMethod;

  calculateTotal();
}

/* ---------- イベント登録と初期化 ---------- */
window.addEventListener("DOMContentLoaded", function() {
  restoreAllFields();
  productNameSelect.addEventListener("change", setProductNoOptions);
  productNoSelect.addEventListener("change", setColorNameOptions);
  colorNameSelect.addEventListener("change", setColorNoOptions);

  // draft時の必須外し
  const draftBtn = document.getElementById('draftSubmit');
  const form = document.getElementById('orderForm');
  if (draftBtn && form) {
    draftBtn.addEventListener('click', function (e) {
      const requiredElements = form.querySelectorAll('[required]');
      requiredElements.forEach(el => el.removeAttribute('required'));
      form.submit();
    });
  }
});
window.addEventListener('pageshow', restoreAllFields);

/* lineUserId自動セット */
(function () {
  const params = new URLSearchParams(window.location.search);
  const uid = params.get('uid');
  if (uid) {
    document.getElementById('lineUserId').value = uid;
  }
})();
</script>
</body>
</html>