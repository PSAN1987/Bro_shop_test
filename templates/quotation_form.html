
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>見積番号管理フォーム</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 1em;
        }
        label {
            display: block;
            margin-top: 1em;
        }
        input[type=text], textarea, select {
            width: 100%;
            padding: 0.5em;
            margin-top: 0.3em;
        }
        input[type=submit] {
            margin-top: 1em;
            padding: 0.7em 1em;
        }
    </style>
</head>
<body>
    <h2>見積番号管理フォーム</h2>
    <form action="/submit_quotation" method="post">
        <input type="hidden" name="form_token" value="{{ token }}">

        <!-- 基本情報 -->
        <label>見積番号: <input type="text" name="quote_no" required value="{{ prefill.get('quote_no', '') }}"></label>
        <label>ユーザーID: <input type="text" name="user_id" required value="{{ prefill.get('user_id', '') }}"></label>
        <label>属性: <input type="text" name="attribute" required value="{{ prefill.get('attribute', '') }}"></label>
        <label>使用日(割引区分): <input type="text" name="usage_date" required value="{{ prefill.get('usage_date', '') }}"></label>
        <label>商品カテゴリー: <input type="text" name="product_category" required value="{{ prefill.get('product_category', '') }}"></label>
        <label>パターン: <input type="text" name="pattern" required value="{{ prefill.get('pattern', '') }}"></label>
        <label>枚数: <input type="text" name="quantity" required value="{{ prefill.get('quantity', '') }}"></label>
        <label>合計金額: <input type="text" name="total_price" required value="{{ prefill.get('total_price', '') }}"></label>
        <label>単価: <input type="text" name="unit_price" required value="{{ prefill.get('unit_price', '') }}"></label>

        <!-- ボディ情報 -->
        <label>ボディ品番:
          <select name="body_code">
            {% for opt in options.body_code %}
              <option value="{{ opt }}" {% if prefill.get('body_code') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>
        <label>ボディ商品名:
          <select name="body_name">
            {% for opt in options.body_name %}
              <option value="{{ opt }}" {% if prefill.get('body_name') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>
        <label>ボディカラーNo:
          <select name="body_color_no">
            {% for opt in options.body_color_no %}
              <option value="{{ opt }}" {% if prefill.get('body_color_no') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>
        <label>商品カラー:
          <select name="body_color">
            {% for opt in options.body_color %}
              <option value="{{ opt }}" {% if prefill.get('body_color') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        <fieldset style="margin-top:1.5em; border:1px solid #ccc; padding:1em;">
          <legend>サイズ別の注文数</legend>
          <label>SS: <input type="number" name="size_count_SS" min="0" value="{{ prefill.get('size_count_SS', '') }}" oninput="updateOrderCount()"></label>
          <label>S: <input type="number" name="size_count_S" min="0" value="{{ prefill.get('size_count_S', '') }}" oninput="updateOrderCount()"></label>
          <label>M: <input type="number" name="size_count_M" min="0" value="{{ prefill.get('size_count_M', '') }}" oninput="updateOrderCount()"></label>
          <label>L: <input type="number" name="size_count_L" min="0" value="{{ prefill.get('size_count_L', '') }}" oninput="updateOrderCount()"></label>
          <label>XL: <input type="number" name="size_count_XL" min="0" value="{{ prefill.get('size_count_XL', '') }}" oninput="updateOrderCount()"></label>
          <label>XXL: <input type="number" name="size_count_XXL" min="0" value="{{ prefill.get('size_count_XXL', '') }}" oninput="updateOrderCount()"></label>
          <label>XXXL: <input type="number" name="size_count_XXXL" min="0" value="{{ prefill.get('size_count_XXXL', '') }}" oninput="updateOrderCount()"></label>
          <label>XXXXL: <input type="number" name="size_count_XXXXL" min="0" value="{{ prefill.get('size_count_XXXXL', '') }}" oninput="updateOrderCount()"></label>
        </fieldset>
        <label>注文数:
          <input type="number" name="order_count" id="order_count" readonly value="{{ prefill.get('order_count', '') }}">
        </label>
        <!-- プリント情報 -->
        <label>プリント箇所数:
          <select name="print_area_count">
            {% for opt in options.print_area_count %}
              <option value="{{ opt }}" {% if prefill.get('print_area_count') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>

        {% for i in range(1, 5) %}
        <fieldset style="margin-top:1.5em; border:1px solid #ccc; padding:1em;">
            <legend>プリント情報 {{ i }}箇所目</legend>
            <label>位置:
              <select name="print_position_{{ i }}">
                {% for opt in options.print_position %}
                  <option value="{{ opt }}" {% if prefill.get('print_position_' ~ i) == opt %}selected{% endif %}>{{ opt }}</option>
                {% endfor %}
              </select>
            </label>
            <label>デザイン:
              <select name="print_design_{{ i }}">
                {% for opt in options.print_design %}
                  <option value="{{ opt }}" {% if prefill.get('print_design_' ~ i) == opt %}selected{% endif %}>{{ opt }}</option>
                {% endfor %}
              </select>
            </label>
            <label>カラー数:
              <select name="print_color_count_{{ i }}">
                {% for opt in options.print_color_count %}
                  <option value="{{ opt }}" {% if prefill.get('print_color_count_' ~ i) == opt %}selected{% endif %}>{{ opt }}</option>
                {% endfor %}
              </select>
            </label>
            <label>カラー内容:
              <select name="print_color_{{ i }}">
                {% for opt in options.print_color %}
                  <option value="{{ opt }}" {% if prefill.get('print_color_' ~ i) == opt %}selected{% endif %}>{{ opt }}</option>
                {% endfor %}
              </select>
            </label>
            <label>デザインサイズ: <input type="text" name="print_size_{{ i }}" value="{{ prefill.get('print_size_' ~ i, '') }}"></label>
        </fieldset>
        {% endfor %}

        <!-- 背番号/背ネーム -->
        <label>背番号:
          <select name="jersey_number">
            {% for opt in options.jersey_number %}
              <option value="{{ opt }}" {% if prefill.get('jersey_number') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>
        <label>背ネーム:
          <select name="jersey_name">
            {% for opt in options.jersey_name %}
              <option value="{{ opt }}" {% if prefill.get('jersey_name') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>
        <label>背番号カラー:
          <select name="jersey_number_color">
            {% for opt in options.jersey_number_color %}
              <option value="{{ opt }}" {% if prefill.get('jersey_number_color') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>
        <label>背ネームカラー:
          <select name="jersey_name_color">
            {% for opt in options.jersey_name_color %}
              <option value="{{ opt }}" {% if prefill.get('jersey_name_color') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>
        <label>フチ付き:
          <select name="outline_enabled">
            {% for opt in options.outline_enabled %}
              <option value="{{ opt }}" {% if prefill.get('outline_enabled') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>
        <label>記号:
          <select name="symbol">
            {% for opt in options.symbol %}
              <option value="{{ opt }}" {% if prefill.get('symbol') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>

        <!-- 加工・納期 -->
        <label>加工方法:
          <select name="processing_method">
            {% for opt in options.processing_method %}
              <option value="{{ opt }}" {% if prefill.get('processing_method') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>
        <label>納期: <input type="text" name="delivery_date" value="{{ prefill.get('delivery_date', '') }}"></label>
        <label>支払い方法:
          <select name="payment_method">
            {% for opt in options.payment_method %}
              <option value="{{ opt }}" {% if prefill.get('payment_method') == opt %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
          </select>
        </label>

        <!-- 備考欄 -->
        <label>特殊仕様: <textarea name="special_spec">{{ prefill.get('special_spec', '') }}</textarea></label>
        <label>希望納期: <textarea name="requested_delivery">{{ prefill.get('requested_delivery', '') }}</textarea></label>
        <label>袋詰め有無: <input type="text" name="packaging" value="{{ prefill.get('packaging', '') }}"></label>
        <label>その他: <textarea name="other_notes">{{ prefill.get('other_notes', '') }}</textarea></label>

        <!-- ヒアリング後の反映情報 -->
        <label>パターン料金: <input type="text" name="pattern_fee" value="{{ prefill.get('pattern_fee', '') }}"></label>
        <label>枚数（ロット）: <input type="text" name="lot_size" value="{{ prefill.get('lot_size', '') }}"></label>
        <label>送料: <input type="text" name="shipping_fee" value="{{ prefill.get('shipping_fee', '') }}"></label>
        <label>納期（希望日）: <input type="text" name="delivery_request_date" value="{{ prefill.get('delivery_request_date', '') }}"></label>

        <!-- URL -->
        <label>見積番号管理WEBフォームURL: <input type="text" name="form_url" value="{{ prefill.get('form_url', '') }}"></label>

        <input type="submit" value="保存">
    </form>
<script>
function updateOrderCount() {
    const sizes = ["SS", "S", "M", "L", "XL", "XXL", "XXXL", "XXXXL"];
    let total = 0;
    sizes.forEach(sz => {
        const el = document.querySelector(`[name="size_count_${sz}"]`);
        const val = parseInt(el?.value || 0);
        total += isNaN(val) ? 0 : val;
    });
    const orderField = document.querySelector(`[name="order_count"]`);
    if (orderField) orderField.value = total;
}
</script>
</body>
</html>
